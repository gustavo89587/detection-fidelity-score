title: Suspicious PowerShell Encoded Command with Download Primitive
id: DFS-PS-ENC-DL-001
status: test
description: Detects PowerShell execution using encoded command combined with network download primitives.
author: Gustavo Okamoto
date: 2026-02-14

logsource:
  product: windows
  category: process_creation

detection:
  selection_ps:
    Image|endswith: '\powershell.exe'
    CommandLine|contains:
      - ' -enc '
      - ' -encodedcommand '

  selection_download:
    CommandLine|contains:
      - 'Invoke-WebRequest'
      - 'iwr '
      - 'curl '
      - 'wget '
      - 'Start-BitsTransfer'

  filter_system_accounts:
    User|startswith:
      - 'NT AUTHORITY'
      - 'SYSTEM'

  condition: selection_ps and selection_download and not filter_system_accounts

falsepositives:
  - Administrative automation scripts
  - Enterprise deployment tools
  - Configuration management frameworks

level: medium

tags:
  - attack.execution
  - attack.t1059.001
