dfs_version: "1.0"

detection_id: "DFS-PS-ENC-DL-001"

hypothesis: >
  An adversary executes PowerShell using encoded commands to obfuscate payload
  delivery and initiates network retrieval to stage second-phase execution.

telemetry_requirements:
  required:
    - source: Sysmon
      event_id: 1
      fields:
        - Image
        - CommandLine
        - ParentImage
        - User
        - IntegrityLevel
    - source: Security
      event_id: 4688
      fields:
        - NewProcessName
        - CommandLine
        - SubjectUserName

trust_decision_boundary:
  decision: "Escalate to analyst triage"
  tier: "T2"
  automated_response: false
  rationale: >
    Behavior indicates payload staging but is prone to legitimate automation use.

degradation_profile:
  loss:
    risk: medium
    cause:
      - Process creation logging disabled
      - CommandLine logging disabled
  distortion:
    risk: high
    cause:
      - CommandLine truncation
      - EDR normalization
  drift:
    risk: high
    evolution_paths:
      - Replace IWR with certutil
      - Replace PowerShell with mshta
      - Split encoded payload across variables

false_positive_surface:
  scenarios:
    - IT automation scripts
    - Software deployment systems
  mitigation:
    - Restrict to user-context executions
    - Require external network indicators in phase 2

validation_protocol:
  pass:
    - EventID 1 or 4688 generated
    - CommandLine contains encoded flag
    - CommandLine contains download primitive
  fail:
    - Missing CommandLine field
    - Encoded command without network primitive
    - Variation using alternative LOLBins not detected

review_cycle_days: 30
owner: Gustavo Okamoto
